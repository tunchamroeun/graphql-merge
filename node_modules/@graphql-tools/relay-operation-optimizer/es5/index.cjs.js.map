{"version":3,"file":"index.cjs.js","sources":["../../../dist-es5/relay-operation-optimizer/src/index.js"],"sourcesContent":["import { __assign, __read, __spread } from \"tslib\";\nimport { printSchemaWithDirectives } from '@graphql-tools/utils';\nimport { parse, concatAST } from 'graphql';\nimport { transform as skipRedundantNodesTransform } from 'relay-compiler/lib/transforms/SkipRedundantNodesTransform';\nimport { transform as inlineFragmentsTransform } from 'relay-compiler/lib/transforms/InlineFragmentsTransform';\nimport { transform as applyFragmentArgumentTransform } from 'relay-compiler/lib/transforms/ApplyFragmentArgumentTransform';\nimport { transformWithOptions as flattenTransformWithOptions } from 'relay-compiler/lib/transforms/FlattenTransform';\nimport CompilerContext from 'relay-compiler/lib/core/CompilerContext';\nimport { transform as relayTransform } from 'relay-compiler/lib/core/RelayParser';\nimport { print as relayPrint } from 'relay-compiler/lib/core/IRPrinter';\nimport { create as relayCreate } from 'relay-compiler/lib/core/Schema';\nexport function optimizeDocuments(schema, documents, options) {\n    if (options === void 0) { options = {}; }\n    options = __assign({ noLocation: true }, options);\n    // @TODO way for users to define directives they use, otherwise relay will throw an unknown directive error\n    // Maybe we can scan the queries and add them dynamically without users having to do some extra stuff\n    // transformASTSchema creates a new schema instance instead of mutating the old one\n    var adjustedSchema = relayCreate(printSchemaWithDirectives(schema, options));\n    var documentAsts = concatAST(documents);\n    var relayDocuments = relayTransform(adjustedSchema, documentAsts.definitions);\n    var result = [];\n    if (options.includeFragments) {\n        var fragmentCompilerContext = new CompilerContext(adjustedSchema)\n            .addAll(relayDocuments)\n            .applyTransforms([\n            applyFragmentArgumentTransform,\n            flattenTransformWithOptions({ flattenAbstractTypes: false }),\n            skipRedundantNodesTransform,\n        ]);\n        result.push.apply(result, __spread(fragmentCompilerContext\n            .documents()\n            .filter(function (doc) { return doc.kind === 'Fragment'; })\n            .map(function (doc) { return parse(relayPrint(adjustedSchema, doc), options); })));\n    }\n    var queryCompilerContext = new CompilerContext(adjustedSchema)\n        .addAll(relayDocuments)\n        .applyTransforms([\n        applyFragmentArgumentTransform,\n        inlineFragmentsTransform,\n        flattenTransformWithOptions({ flattenAbstractTypes: false }),\n        skipRedundantNodesTransform,\n    ]);\n    result.push.apply(result, __spread(queryCompilerContext.documents().map(function (doc) { return parse(relayPrint(adjustedSchema, doc), options); })));\n    return result;\n}\n//# sourceMappingURL=index.js.map"],"names":["__assign","relayCreate","printSchemaWithDirectives","concatAST","relayTransform","applyFragmentArgumentTransform","flattenTransformWithOptions","skipRedundantNodesTransform","__spread","parse","relayPrint","inlineFragmentsTransform"],"mappings":";;;;;;;;;;;;;;;;;;AAWO,SAAS,iBAAiB,CAAC,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE;AAC9D,IAAI,IAAI,OAAO,KAAK,KAAK,CAAC,EAAE,EAAE,OAAO,GAAG,EAAE,CAAC,EAAE;AAC7C,IAAI,OAAO,GAAGA,cAAQ,CAAC,EAAE,UAAU,EAAE,IAAI,EAAE,EAAE,OAAO,CAAC,CAAC;AACtD;AACA;AACA;AACA,IAAI,IAAI,cAAc,GAAGC,aAAW,CAACC,+BAAyB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC;AACjF,IAAI,IAAI,YAAY,GAAGC,iBAAS,CAAC,SAAS,CAAC,CAAC;AAC5C,IAAI,IAAI,cAAc,GAAGC,qBAAc,CAAC,cAAc,EAAE,YAAY,CAAC,WAAW,CAAC,CAAC;AAClF,IAAI,IAAI,MAAM,GAAG,EAAE,CAAC;AACpB,IAAI,IAAI,OAAO,CAAC,gBAAgB,EAAE;AAClC,QAAQ,IAAI,uBAAuB,GAAG,IAAI,eAAe,CAAC,cAAc,CAAC;AACzE,aAAa,MAAM,CAAC,cAAc,CAAC;AACnC,aAAa,eAAe,CAAC;AAC7B,YAAYC,wCAA8B;AAC1C,YAAYC,qCAA2B,CAAC,EAAE,oBAAoB,EAAE,KAAK,EAAE,CAAC;AACxE,YAAYC,qCAA2B;AACvC,SAAS,CAAC,CAAC;AACX,QAAQ,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,EAAEC,cAAQ,CAAC,uBAAuB;AAClE,aAAa,SAAS,EAAE;AACxB,aAAa,MAAM,CAAC,UAAU,GAAG,EAAE,EAAE,OAAO,GAAG,CAAC,IAAI,KAAK,UAAU,CAAC,EAAE,CAAC;AACvE,aAAa,GAAG,CAAC,UAAU,GAAG,EAAE,EAAE,OAAOC,aAAK,CAACC,eAAU,CAAC,cAAc,EAAE,GAAG,CAAC,EAAE,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAC/F,KAAK;AACL,IAAI,IAAI,oBAAoB,GAAG,IAAI,eAAe,CAAC,cAAc,CAAC;AAClE,SAAS,MAAM,CAAC,cAAc,CAAC;AAC/B,SAAS,eAAe,CAAC;AACzB,QAAQL,wCAA8B;AACtC,QAAQM,kCAAwB;AAChC,QAAQL,qCAA2B,CAAC,EAAE,oBAAoB,EAAE,KAAK,EAAE,CAAC;AACpE,QAAQC,qCAA2B;AACnC,KAAK,CAAC,CAAC;AACP,IAAI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,EAAEC,cAAQ,CAAC,oBAAoB,CAAC,SAAS,EAAE,CAAC,GAAG,CAAC,UAAU,GAAG,EAAE,EAAE,OAAOC,aAAK,CAACC,eAAU,CAAC,cAAc,EAAE,GAAG,CAAC,EAAE,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAC1J,IAAI,OAAO,MAAM,CAAC;AAClB;;;;"}